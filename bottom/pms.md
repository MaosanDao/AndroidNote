# Android PMS和App安装过程分析（[原文](https://www.cnblogs.com/Jax/p/6910745.html)）
```
PMS，全称PackageManagerService，是用来获取Apk包的信息的。

在前面分析四大组件与AMS通信的时候，我们介绍过，AMS总是会使用PMS加载包的信息，
将其封装在LoadedApk这个类对象中，然后我们就可以从中取出在manifest声明的四大组件信息了。
```
## App安装过程
```
Android系统使用PMS解析这个Apk中的manifest文件，包括：

  1.四大组件的信息，比如，静态Receiver，默认启动的Activity等。
  2.分配用户Id和用户组Id。用户Id是唯一的，因为Android是一个Linux系统。
    用户组Id指的是各种权限，每个权限都在一个用户组中，比如读写SD卡，比如网络访问，分配了哪些用户组Id，就拥有了哪些权限。
  3.在Launcher中生成一个ICON，icon中保存了默认启动Activity的信息。
  4.App安装过程的最后，是把上面的这些信息记录在一个XML文件中，以备下次安装再用。
```
## 每次开机都安装App
```
其实，在Android手机系统每次启动的时候，都会使用PMS，把Android系统中的所有Apk都安装一遍，一共4个步骤，如下所示：
```
![](https://images2015.cnblogs.com/blog/13430/201705/13430-20170526223853482-683221082.png)
```
其中第三步、第四步和单独安装一个App的步骤是一样的。

  第一步：因为结束安装的时候，都会把安装信息保存在xml文件中，所以Android系统再次启动时，
         再次重新安装所有的Apk，就可以直接读取之前保存的xml文件了。
         
  第二步：安装五个目录下的Apk。
```
## 为什么不解压后安装Apk啊？
```
每次从apk中读取资源，并不是先解压再找图片资源，而是解析Apk中的Resource.arsc文件，
这个文件中存储着资源的所有信息，包括资源在Apk中的地址、大小等等，按图索引，从这个文件中快速找到相应的资源文件。这是一种很高效的算法。

不解压Apk的好处，则是节省空间。
```


















































































